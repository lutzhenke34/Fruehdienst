<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arbeitsanweisung</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f2f2f7;
    padding: 20px;
}

h1 {
    text-align: center;
}

#counter {
    text-align: center;
    margin-bottom: 10px;
    font-weight: bold;
}

button {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
}

.reset-btn { background: #ff3b30; color: white; }
.reminder-btn { background: #007aff; color: white; }

.task {
    background: white;
    padding: 15px;
    margin-bottom: 8px;
    border-radius: 12px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    cursor: pointer;
    transition: 0.2s;
}

.subtask { margin-left: 20px; }

.task.done {
    background: #34c759;
    color: white;
    text-decoration: line-through;
}
</style>
</head>

<body>

<h1>Arbeitsanweisung</h1>

<div id="counter"></div>
<button class="reset-btn" onclick="resetTasks()">üîÑ Alle Aufgaben zur√ºcksetzen</button>
<button class="reminder-btn" onclick="activateReminder()">üîî Erinnerung aktivieren</button>

<div class="task">1 - Arbeitsplatz aufbauen</div>
<div class="task">2 - Tagesaktuelle Zahlen erfassen</div>
<div class="task">3 - Equipment bereitstellen</div>

<div class="task parent">4 - Gem√ºse holen und waschen</div>
<div class="task subtask" data-parent="4">Salatmix mitnehmen (Wagen nutzen)</div>
<div class="task subtask" data-parent="4">Eisberg vorbereiten</div>
<div class="task subtask" data-parent="4">Radicchio vorbereiten</div>
<div class="task subtask" data-parent="4">Spinat vorbereiten</div>

<div class="task">5 - Salatmix vorbereiten</div>
<div class="task">6 - Gurke, Tomate, M√∂hre vorbereiten</div>
<div class="task">7 - Restliches Gem√ºse schneiden</div>
<div class="task">8 - Angemachte Salate abf√ºllen</div>
<div class="task">9 - Salate f√ºr Personal & Tagesklinik abf√ºllen</div>

<div class="task parent weekday" data-day="1,3,5">10 - Dressing abf√ºllen (Mo/Mi/Fr)</div>

<div class="task">11 - Dessert abf√ºllen</div>
<div class="task">12 - Salate neu machen (3x t√§glich)</div>
<div class="task">13 - Dessert f√ºr n√§chsten Tag vorbereiten</div>
<div class="task">14 - 2x kalte Vorspeise vorbereiten</div>

<!-- Kaffeepause nach Wochentag -->

<div class="task weekday" data-day="1">
15 - Kaffeepause Mo (Laugenstange mit Frischk√§se)
</div>

<div class="task weekday" data-day="2">
15 - Kaffeepause Di (Kuchen)
</div>

<div class="task weekday" data-day="3">
15 - Kaffeepause Mi (Gem√ºsesticks / Gurkensticks im Wechsel)
</div>

<div class="task weekday" data-day="4">
15 - Kaffeepause Do (Kuchen)
</div>

<div class="task weekday" data-day="5">
15 - Kaffeepause Fr (Brezeln mit Butter)
</div>

<div class="task weekday" data-day="6">
15 - Kaffeepause Sa (Kuchen)
</div>

<div class="task weekday" data-day="0">
15 - Kaffeepause So (Kuchen)
</div>

<div class="task">16 - Salat waschen und zupfen</div>
<div class="task">17 - Ingwershot produzieren</div>
<div class="task">18 - Kuchen backen</div>

<script>
function getTasks() {
    return document.querySelectorAll('.task');
}

const counter = document.getElementById('counter');

function updateCounter() {
    const tasks = getTasks();
    const done = document.querySelectorAll('.task.done').length;
    counter.innerText = done + " von " + tasks.length + " erledigt";
}

function saveState() {
    const states = [];
    getTasks().forEach(task => {
        states.push(task.classList.contains('done'));
    });
    localStorage.setItem("taskStates", JSON.stringify(states));
}

function loadState() {
    const savedDate = localStorage.getItem("savedDate");
    const today = new Date().toDateString();

    if (savedDate !== today) {
        localStorage.setItem("savedDate", today);
        return;
    }

    const states = JSON.parse(localStorage.getItem("taskStates"));
    if (states) {
        getTasks().forEach((task, index) => {
            if (states[index]) task.classList.add('done');
        });
    }
    updateCounter();
}

function resetTasks() {
    getTasks().forEach(task => task.classList.remove('done'));
    saveState();
    updateCounter();
}

document.addEventListener("click", function(e){
    if(e.target.classList.contains("task")){
        e.target.classList.toggle("done");
        checkParentCompletion();
        saveState();
        updateCounter();
    }
});

function checkParentCompletion(){
    const parent = document.querySelector('.task.parent');
    const subtasks = document.querySelectorAll('.subtask');
    if(subtasks.length){
        const allDone = [...subtasks].every(t => t.classList.contains('done'));
        if(allDone){
            document.querySelector('[data-parent="4"]').parentElement.previousElementSibling.classList.add('done');
        }
    }
}

// üìÜ Wochentag anzeigen
function checkWeekday(){
    const today = new Date().getDay(); // 0=So,1=Mo
    document.querySelectorAll('.weekday').forEach(task=>{
        const allowed = task.dataset.day.split(",");
        if(!allowed.includes(String(today))){
            task.style.display = "none";
        }
    });
}

// üîî Erinnerung
function activateReminder(){
    if(Notification.permission !== "granted"){
        Notification.requestPermission();
    }

    setInterval(()=>{
        const hour = new Date().getHours();
        if(hour === 9){
            new Notification("Arbeitsanweisung starten ‚úÖ");
        }
    }, 60000);

    alert("Erinnerung aktiviert (9:00 Uhr t√§glich)");
}

checkWeekday();
loadState();
updateCounter();
</script>

</body>
</html>